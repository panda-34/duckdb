# name: test/sql/pivot/pivot_tpch.test_slow
# description: Test pivot on the TPC-H dataset
# group: [pivot]

require tpch

statement ok
CALL dbgen(sf=0.1);

query IIIII
FROM (PIVOT lineitem ON l_shipinstruct USING SUM(l_quantity) GROUP BY l_returnflag) ORDER BY ALL;
----
A	943655	940094	946224	944227
N	1938403	1930781	1951198	1954697
R	950702	947111	937692	950018

query IIIII
SELECT * FROM lineitem PIVOT (SUM(l_quantity) FOR l_shipinstruct IN ('COLLECT COD', 'DELIVER IN PERSON', 'NONE', 'TAKE BACK RETURN') GROUP BY l_returnflag) ORDER BY ALL;
----
A	943655	940094	946224	944227
N	1938403	1930781	1951198	1954697
R	950702	947111	937692	950018

query IIIII
SELECT * FROM (SELECT l_shipinstruct, l_quantity, l_returnflag FROM lineitem) PIVOT (SUM(l_quantity) FOR l_shipinstruct IN ('COLLECT COD', 'DELIVER IN PERSON', 'NONE', 'TAKE BACK RETURN')) ORDER BY ALL;
----
A	943655	940094	946224	944227
N	1938403	1930781	1951198	1954697
R	950702	947111	937692	950018

query IIIIIIII
FROM (PIVOT (SELECT YEAR(l_shipdate) AS year, l_returnflag, l_quantity FROM lineitem) ON year USING SUM(l_quantity)) ORDER BY ALL
----
A	968197	1138593	1177788	489622	NULL	NULL	NULL
N	NULL	NULL	NULL	1362746	2331027	2312320	1768986
R	984816	1143586	1170734	486387	NULL	NULL	NULL

query IIIIIIII
SELECT * FROM
	(SELECT YEAR(l_shipdate) AS year, l_returnflag, l_quantity FROM lineitem)
	PIVOT (SUM(l_quantity) FOR year IN (1992, 1993, 1994, 1995, 1996, 1997, 1998))
ORDER BY ALL
----
A	968197	1138593	1177788	489622	NULL	NULL	NULL
N	NULL	NULL	NULL	1362746	2331027	2312320	1768986
R	984816	1143586	1170734	486387	NULL	NULL	NULL
