# name: test/variant/test_variant.test
# description: Test Variant SQL functions
# group: [variant]

require variant

statement ok
CREATE TYPE enum_type AS ENUM ('one', 'two', 'three');

# CONSTANT_VECTOR
query I
SELECT VARIANT(-300::SMALLINT) FROM RANGE(1, 3);
----
\x0C\xD4\xFE
\x0C\xD4\xFE

query I
SELECT FROM_VARIANT('SMALLINT', '\x0C\xD4\xFE'::BLOB) FROM RANGE(1, 3);
----
-300
-300

# FLAT_VECTOR
query I
SELECT VARIANT(range-300) FROM RANGE(1, 3);
----
\x0E\xD5\xFE\xFF\xFF\xFF\xFF\xFF\xFF
\x0E\xD6\xFE\xFF\xFF\xFF\xFF\xFF\xFF

query I
SELECT FROM_VARIANT('SMALLINT', ('\x0C\xD4\xF' || range)::BLOB) FROM RANGE(1, 3);
----
-3628
-3372

# SEQUENCE_VECTOR
query I
SELECT VARIANT(range) FROM RANGE(-310, -301, 3);
----
\x0E\xCA\xFE\xFF\xFF\xFF\xFF\xFF\xFF
\x0E\xCD\xFE\xFF\xFF\xFF\xFF\xFF\xFF
\x0E\xD0\xFE\xFF\xFF\xFF\xFF\xFF\xFF

# DICTIONARY_VECTOR
query I
SELECT VARIANT(range) FROM RANGE(-310, -301) WHERE range % 3 = 0;
----
\x0E\xCB\xFE\xFF\xFF\xFF\xFF\xFF\xFF
\x0E\xCE\xFE\xFF\xFF\xFF\xFF\xFF\xFF
\x0E\xD1\xFE\xFF\xFF\xFF\xFF\xFF\xFF

statement ok
CREATE TABLE t (i INT, b BLOB);

statement ok
INSERT INTO t SELECT range, ('\x0C\xD4\xF' || range)::BLOB FROM RANGE(10);

query I
SELECT FROM_VARIANT('SMALLINT', b) FROM t WHERE i % 3 = 0;
----
-3884
-3116
-2348
-1580

# nested
query I
SELECT FROM_VARIANT('INT', VARIANT([11, 22, 33]), 1);
----
22

query I
SELECT FROM_VARIANT('DATE', VARIANT([['2021-12-31', '2021-11-30', '2021-10-31'], ['2021-09-29', '2021-08-31']]::DATE[][]), 1, 0);
----
2021-09-29

statement ok
INSERT INTO t VALUES (-1, VARIANT([{'bool': TRUE, 'string': 'hello', 'a list': [0, NULL, 127]::TINYINT[], 'null': NULL, 'another list': []::VARCHAR[], 'nested': {'child1': 123, 'child2': 'a string'}}, NULL, {'bool': FALSE, 'string': 'goodbye', 'a list': []::TINYINT[], 'null': NULL, 'another list': ['one', 'two'], 'nested': {'child1': 456, 'child2': 'also a string'}}]));

query III
SELECT FROM_VARIANT('BOOL', b, 0, 'bool'), FROM_VARIANT('VARCHAR', b, 2, 'nested', 'child2'), FROM_VARIANT('TINYINT', b, 0, 'a list', 2) FROM t WHERE i = -1;
----
true	also a string	127

# generated data

query I
SELECT VARIANT(NULL);
----
NULL

query I
SELECT FROM_VARIANT('NULL', NULL);
----
NULL

query I
SELECT VARIANT(FALSE);
----
\x0A\x00

query I
SELECT FROM_VARIANT('BOOLEAN', '\x0A\x00'::BLOB);
----
false

query I
SELECT VARIANT(TRUE);
----
\x0A\x01

query I
SELECT FROM_VARIANT('BOOLEAN', '\x0A\x01'::BLOB);
----
true

query I
SELECT VARIANT(-120::TINYINT);
----
\x0B\x88

query I
SELECT FROM_VARIANT('TINYINT', '\x0B\x88'::BLOB);
----
-120

query I
SELECT VARIANT(254::UTINYINT);
----
\x1C\xFE

query I
SELECT FROM_VARIANT('UTINYINT', '\x1C\xFE'::BLOB);
----
254

query I
SELECT VARIANT(-32000::SMALLINT);
----
\x0C\x00\x83

query I
SELECT FROM_VARIANT('SMALLINT', '\x0C\x00\x83'::BLOB);
----
-32000

query I
SELECT VARIANT(65000::USMALLINT);
----
\x1D\xE8\xFD

query I
SELECT FROM_VARIANT('USMALLINT', '\x1D\xE8\xFD'::BLOB);
----
65000

query I
SELECT VARIANT(-65000::INTEGER);
----
\x0D\x18\x02\xFF\xFF

query I
SELECT FROM_VARIANT('INTEGER', '\x0D\x18\x02\xFF\xFF'::BLOB);
----
-65000

query I
SELECT VARIANT(2147483649::UINTEGER);
----
\x1E\x01\x00\x00\x80

query I
SELECT FROM_VARIANT('UINTEGER', '\x1E\x01\x00\x00\x80'::BLOB);
----
2147483649

query I
SELECT VARIANT(-2::BIGINT);
----
\x0E\xFE\xFF\xFF\xFF\xFF\xFF\xFF\xFF

query I
SELECT FROM_VARIANT('BIGINT', '\x0E\xFE\xFF\xFF\xFF\xFF\xFF\xFF\xFF'::BLOB);
----
-2

query I
SELECT VARIANT(9223653507536580609::UBIGINT);
----
\x1F\x01\xF0\x00\x00\xFF\xFF\x00\x80

query I
SELECT FROM_VARIANT('UBIGINT', '\x1F\x01\xF0\x00\x00\xFF\xFF\x00\x80'::BLOB);
----
9223653507536580609

query I
SELECT VARIANT(-170141183460469231731687303715884105727::HUGEINT);
----
2\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80

query I
SELECT FROM_VARIANT('HUGEINT', '2\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80'::BLOB);
----
-170141183460469231731687303715884105727

query I
SELECT VARIANT(3.14::FLOAT);
----
\x16\xC3\xF5H@

query I
SELECT FROM_VARIANT('FLOAT', '\x16\xC3\xF5H@'::BLOB);
----
3.14

query I
SELECT VARIANT(3.14::DOUBLE);
----
\x17\x1F\x85\xEBQ\xB8\x1E\x09@

query I
SELECT FROM_VARIANT('DOUBLE', '\x17\x1F\x85\xEBQ\xB8\x1E\x09@'::BLOB);
----
3.14

query I
SELECT VARIANT('2021-12-31'::DATE);
----
\x0F0J\x00\x00

query I
SELECT FROM_VARIANT('DATE', '\x0F0J\x00\x00'::BLOB);
----
2021-12-31

query I
SELECT VARIANT('16:54:59.999999'::TIME);
----
\x10\xFF@\xEC-\x0E\x00\x00\x00

query I
SELECT FROM_VARIANT('TIME', '\x10\xFF@\xEC-\x0E\x00\x00\x00'::BLOB);
----
16:54:59.999999

query I
SELECT VARIANT('16:54:59'::TIMETZ);
----
"\xC0\xFE\xDC-\x0E\x00\x00\x00

query I
SELECT FROM_VARIANT('TIMETZ', '"\xC0\xFE\xDC-\x0E\x00\x00\x00'::BLOB);
----
16:54:59+00

query I
SELECT VARIANT('2021-12-31 16:54:59'::TIMESTAMP);
----
\x13\xC0\xFE\xFE\x07t\xD4\x05\x00

query I
SELECT FROM_VARIANT('TIMESTAMP', '\x13\xC0\xFE\xFE\x07t\xD4\x05\x00'::BLOB);
----
2021-12-31 16:54:59

query I
SELECT VARIANT('2021-12-31 16:54:59'::TIMESTAMPTZ);
----
 \xC0\xFE\xFE\x07t\xD4\x05\x00

query I
SELECT FROM_VARIANT('TIMESTAMPTZ', ' \xC0\xFE\xFE\x07t\xD4\x05\x00'::BLOB);
----
2021-12-31 16:54:59+00

query I
SELECT VARIANT('1970-01-01 00:16:40'::TIMESTAMP_S);
----
\x11\xE8\x03\x00\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('TIMESTAMP_S', '\x11\xE8\x03\x00\x00\x00\x00\x00\x00'::BLOB);
----
1970-01-01 00:16:40

query I
SELECT VARIANT('1970-01-01 00:16:40'::TIMESTAMP_MS);
----
\x12@B\x0F\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('TIMESTAMP_MS', '\x12@B\x0F\x00\x00\x00\x00\x00'::BLOB);
----
1970-01-01 00:16:40

query I
SELECT VARIANT('1970-01-01 00:16:40'::TIMESTAMP_NS);
----
\x14\x00\x10\xA5\xD4\xE8\x00\x00\x00

query I
SELECT FROM_VARIANT('TIMESTAMP_NS', '\x14\x00\x10\xA5\xD4\xE8\x00\x00\x00'::BLOB);
----
1970-01-01 00:16:40

query I
SELECT VARIANT('1 year 1 month 18 days 02:46:40'::INTERVAL);
----
\x1B\x0D\x00\x00\x00\x12\x00\x00\x00\x00\xE4\x0BT\x02\x00\x00\x00

query I
SELECT FROM_VARIANT('INTERVAL', '\x1B\x0D\x00\x00\x00\x12\x00\x00\x00\x00\xE4\x0BT\x02\x00\x00\x00'::BLOB);
----
1 year 1 month 18 days 02:46:40

query I
SELECT VARIANT('24090 days 06:49:58'::INTERVAL);
----
\x1B\x00\x00\x00\x00\x1A^\x00\x00\x80\xB1'\xBA\x05\x00\x00\x00

query I
SELECT FROM_VARIANT('INTERVAL', '\x1B\x00\x00\x00\x00\x1A^\x00\x00\x80\xB1\x27\xBA\x05\x00\x00\x00'::BLOB);
----
24090 days 06:49:58

query I
SELECT VARIANT('');
----
\x19

query I
SELECT FROM_VARIANT('VARCHAR', '\x19'::BLOB);
----
(empty)

query I
SELECT VARIANT('a string');
----
\x19a string

query I
SELECT FROM_VARIANT('VARCHAR', '\x19a string'::BLOB);
----
a string

query I
SELECT VARIANT('Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua');
----
\x19Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua

query I
SELECT FROM_VARIANT('VARCHAR', '\x19Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua'::BLOB);
----
Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua

query I
SELECT VARIANT('6b6542ea-863f-4b10-b5ff-ab9ed50f4291'::UUID);
----
6\x91B\x0F\xD5\x9E\xAB\xFF\xB5\x10K?\x86\xEABe\xEB

query I
SELECT FROM_VARIANT('UUID', '6\x91B\x0F\xD5\x9E\xAB\xFF\xB5\x10K?\x86\xEABe\xEB'::BLOB);
----
6b6542ea-863f-4b10-b5ff-ab9ed50f4291

query I
SELECT VARIANT('a\x00blob'::BLOB);
----
\x1Aa\x00blob

query I
SELECT FROM_VARIANT('BLOB', '\x1Aa\x00blob'::BLOB);
----
a\x00blob

query I
SELECT VARIANT(3.141::DECIMAL(4,3));
----
\x15\x04\x03E\x0C

query I
SELECT FROM_VARIANT('DECIMAL(4,3)', '\x15\x04\x03E\x0C'::BLOB);
----
3.141

query I
SELECT VARIANT(3.14159265::DECIMAL(9,8));
----
\x15\x09\x08\xA1\xB0\xB9\x12

query I
SELECT FROM_VARIANT('DECIMAL(9,8)', '\x15\x09\x08\xA1\xB0\xB9\x12'::BLOB);
----
3.14159265

query I
SELECT VARIANT(3.14159265358979323::DECIMAL(18,17));
----
\x15\x12\x11\xFB\xA0\x9E\xF6/\x1E\x5C\x04

query I
SELECT FROM_VARIANT('DECIMAL(18,17)', '\x15\x12\x11\xFB\xA0\x9E\xF6/\x1E\x5C\x04'::BLOB);
----
3.14159265358979323

query I
SELECT VARIANT('-1.7014118346046923173168730371588'::DECIMAL(32,31));
----
\x15 \x1F\xFC\x89o\xCD\xC2C\xBD\x85\x1A*k@)\xFF\xFF\xFF

query I
SELECT FROM_VARIANT('DECIMAL(32,31)', '\x15 \x1F\xFC\x89o\xCD\xC2C\xBD\x85\x1A*k@)\xFF\xFF\xFF'::BLOB);
----
-1.7014118346046923173168730371588

query I
SELECT VARIANT('[{"key": "value}, null, 123, true]'::JSON);
----
#[{"key": "value}, null, 123, true]

query I
SELECT FROM_VARIANT('JSON', '#[{"key": "value}, null, 123, true]'::BLOB);
----
[{"key": "value}, null, 123, true]

query I
SELECT VARIANT('two'::ENUM_TYPE);
----
\x19two

query I
SELECT FROM_VARIANT('VARCHAR', '\x19two'::BLOB);
----
two

query I
SELECT VARIANT([]);
----
e\x01

query I
SELECT VARIANT([NULL]);
----
e\x01\x01\x00\x00\x00\x01\x00\x00\x00\x00

query I
SELECT VARIANT([]::BOOLEAN[]);
----
e\x0A

query I
SELECT FROM_VARIANT('BOOLEAN[]', 'e\x0A'::BLOB);
----
[]

query I
SELECT VARIANT([TRUE, FALSE, NULL, TRUE]);
----
e\x0A\x04\x00\x00\x00\x04\x01\x00\x00\x01

query I
SELECT FROM_VARIANT('BOOLEAN[]', 'e\x0A\x04\x00\x00\x00\x04\x01\x00\x00\x01'::BLOB);
----
[True, False, NULL, True]

query I
SELECT VARIANT([NULL, -128, 127, 0]::TINYINT[]);
----
e\x0B\x04\x00\x00\x00\x01\x00\x80\x00

query I
SELECT FROM_VARIANT('TINYINT[]', 'e\x0B\x04\x00\x00\x00\x01\x00\x80\x00'::BLOB);
----
[NULL, -128, 127, 0]

query I
SELECT VARIANT([0, 127, 128, 255, NULL]::UTINYINT[]);
----
e\x1C\x05\x00\x00\x00\x10\x00\x80\xFF\x00

query I
SELECT FROM_VARIANT('UTINYINT[]', 'e\x1C\x05\x00\x00\x00\x10\x00\x80\xFF\x00'::BLOB);
----
[0, 127, 128, 255, NULL]

query I
SELECT VARIANT([-32768, NULL, 32767]::SMALLINT[]);
----
e\x0C\x03\x00\x00\x00\x02\x00\x80\x00\x00\xFF

query I
SELECT FROM_VARIANT('SMALLINT[]', 'e\x0C\x03\x00\x00\x00\x02\x00\x80\x00\x00\xFF'::BLOB);
----
[-32768, NULL, 32767]

query I
SELECT VARIANT([65535]::USMALLINT[]);
----
e\x1D\x01\x00\x00\x00\x00\xFF\xFF

query I
SELECT FROM_VARIANT('USMALLINT[]', 'e\x1D\x01\x00\x00\x00\x00\xFF\xFF'::BLOB);
----
[65535]

query I
SELECT VARIANT([2147483647, -1, 2, 3, 4, 5, 6, 7, 8, NULL, -2147483648]::INTEGER[]);
----
e\x0D\x0B\x00\x00\x00\x00\x02\xFF\xFF\xFF\xFF\xFF\xFF\xFF\x02\x00\x00\x00\x03\x00\x00\x00\x04\x00\x00\x00\x05\x00\x00\x00\x06\x00\x00\x00\x07\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80

query I
SELECT FROM_VARIANT('INTEGER[]', 'e\x0D\x0B\x00\x00\x00\x00\x02\xFF\xFF\xFF\xFF\xFF\xFF\xFF\x02\x00\x00\x00\x03\x00\x00\x00\x04\x00\x00\x00\x05\x00\x00\x00\x06\x00\x00\x00\x07\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80'::BLOB);
----
[2147483647, -1, 2, 3, 4, 5, 6, 7, 8, NULL, -2147483648]

query I
SELECT VARIANT([2147483649]::UINTEGER[]);
----
e\x1E\x01\x00\x00\x00\x00\x01\x00\x00\x80

query I
SELECT FROM_VARIANT('UINTEGER[]', 'e\x1E\x01\x00\x00\x00\x00\x01\x00\x00\x80'::BLOB);
----
[2147483649]

query I
SELECT VARIANT([9223372036854775807, NULL, -9223372036854775808]::BIGINT[]);
----
e\x0E\x03\x00\x00\x00\x02\xFF\xFF\xFF\xFF\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80

query I
SELECT FROM_VARIANT('BIGINT[]', 'e\x0E\x03\x00\x00\x00\x02\xFF\xFF\xFF\xFF\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80'::BLOB);
----
[9223372036854775807, NULL, -9223372036854775808]

query I
SELECT VARIANT([100, 200]::UBIGINT[]);
----
e\x1F\x02\x00\x00\x00\x00d\x00\x00\x00\x00\x00\x00\x00\xC8\x00\x00\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('UBIGINT[]', 'e\x1F\x02\x00\x00\x00\x00d\x00\x00\x00\x00\x00\x00\x00\xC8\x00\x00\x00\x00\x00\x00\x00'::BLOB);
----
[100, 200]

query I
SELECT VARIANT([-170141183460469231731687303715884105727, -85070591730234615865843651857942052863, NULL]::HUGEINT[]);
----
e2\x03\x00\x00\x00\x04\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('HUGEINT[]', 'e2\x03\x00\x00\x00\x04\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'::BLOB);
----
[-170141183460469231731687303715884105727, -85070591730234615865843651857942052863, NULL]

query I
SELECT VARIANT([3.14, 2.71, 0.0, NULL, 340282346638528859811704183484516925440]::FLOAT[]);
----
e\x16\x05\x00\x00\x00\x08\xC3\xF5H@\xA4p-@\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFF

query I
SELECT FROM_VARIANT('FLOAT[]', 'e\x16\x05\x00\x00\x00\x08\xC3\xF5H@\xA4p-@\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFF'::BLOB);
----
[3.140000, 2.710000, 0.000000, NULL, 340282346638528859811704183484516925440.000000]

query I
SELECT VARIANT([3.14, 2.71, 0.0, NULL, 1.7976931348623157e+308]::DOUBLE[]);
----
e\x17\x05\x00\x00\x00\x08\x1F\x85\xEBQ\xB8\x1E\x09@\xAEG\xE1z\x14\xAE\x05@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFF\xFF\xFF\xFF\xFF\xEF

query I
SELECT FROM_VARIANT('DOUBLE[]', 'e\x17\x05\x00\x00\x00\x08\x1F\x85\xEBQ\xB8\x1E\x09@\xAEG\xE1z\x14\xAE\x05@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFF\xFF\xFF\xFF\xFF\xEF'::BLOB);
----
[3.140000, 2.710000, 0.000000, NULL, 179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000]

query I
SELECT VARIANT(['2021-12-31', NULL, '2022-1-1']::DATE[]);
----
e\x0F\x03\x00\x00\x00\x020J\x00\x00\x00\x00\x00\x001J\x00\x00

query I
SELECT FROM_VARIANT('DATE[]', 'e\x0F\x03\x00\x00\x00\x020J\x00\x00\x00\x00\x00\x001J\x00\x00'::BLOB);
----
[2021-12-31, NULL, 2022-01-01]

query I
SELECT VARIANT(['16:54:59.999999', '0:00:00', NULL]::TIME[]);
----
e\x10\x03\x00\x00\x00\x04\xFF@\xEC-\x0E\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('TIME[]', 'e\x10\x03\x00\x00\x00\x04\xFF@\xEC-\x0E\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'::BLOB);
----
[16:54:59.999999, 00:00:00, NULL]

query I
SELECT VARIANT(['16:54:59.999999', '0:00:00', NULL]::TIMETZ[]);
----
e"\x03\x00\x00\x00\x04\xFF@\xEC-\x0E\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('TIME WITH TIME ZONE[]', 'e"\x03\x00\x00\x00\x04\xFF@\xEC-\x0E\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'::BLOB);
----
[16:54:59.999999+00, 00:00:00+00, NULL]

query I
SELECT VARIANT(['2021-12-31 16:54:59', NULL, '2022-04-26 10:41:39']::TIMESTAMP[]);
----
e\x13\x03\x00\x00\x00\x02\xC0\xFE\xFE\x07t\xD4\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\xC0\x9EqV\x8C\xDD\x05\x00

query I
SELECT FROM_VARIANT('TIMESTAMP[]', 'e\x13\x03\x00\x00\x00\x02\xC0\xFE\xFE\x07t\xD4\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\xC0\x9EqV\x8C\xDD\x05\x00'::BLOB);
----
[2021-12-31 16:54:59, NULL, 2022-04-26 10:41:39]

query I
SELECT VARIANT(['2021-12-31 16:54:59', NULL, '2022-04-26 10:41:39']::TIMESTAMPTZ[]);
----
e \x03\x00\x00\x00\x02\xC0\xFE\xFE\x07t\xD4\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\xC0\x9EqV\x8C\xDD\x05\x00

query I
SELECT FROM_VARIANT('TIMESTAMP WITH TIME ZONE[]', 'e \x03\x00\x00\x00\x02\xC0\xFE\xFE\x07t\xD4\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\xC0\x9EqV\x8C\xDD\x05\x00'::BLOB);
----
[2021-12-31 16:54:59+00, NULL, 2022-04-26 10:41:39+00]

query I
SELECT VARIANT(['2021-12-31 16:54:59', NULL, '2022-04-26 10:41:39']::TIMESTAMP_S[]);
----
e\x11\x03\x00\x00\x00\x02\xE35\xCFa\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00c\xCCgb\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('TIMESTAMP_S[]', 'e\x11\x03\x00\x00\x00\x02\xE35\xCFa\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00c\xCCgb\x00\x00\x00\x00'::BLOB);
----
[2021-12-31 16:54:59, NULL, 2022-04-26 10:41:39]

query I
SELECT VARIANT(['2021-12-31 16:54:59', NULL, '2022-04-26 10:41:39']::TIMESTAMP_MS[]);
----
e\x12\x03\x00\x00\x00\x02\xB8~j\x11~\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xB8bve\x80\x01\x00\x00

query I
SELECT FROM_VARIANT('TIMESTAMP_MS[]', 'e\x12\x03\x00\x00\x00\x02\xB8~j\x11~\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xB8bve\x80\x01\x00\x00'::BLOB);
----
[2021-12-31 16:54:59, NULL, 2022-04-26 10:41:39]

query I
SELECT VARIANT(['2021-12-31 16:54:59', NULL, '2022-04-26 10:41:39']::TIMESTAMP_NS[]);
----
e\x14\x03\x00\x00\x00\x02\x00\x1E\x13<?\xE5\xC5\x16\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1E\xD4\xAB1l\xE9\x16

query I
SELECT FROM_VARIANT('TIMESTAMP_NS[]', 'e\x14\x03\x00\x00\x00\x02\x00\x1E\x13<?\xE5\xC5\x16\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1E\xD4\xAB1l\xE9\x16'::BLOB);
----
[2021-12-31 16:54:59, NULL, 2022-04-26 10:41:39]

query I
SELECT VARIANT(['1 year 1 month 18 days 02:46:40', NULL, '10 years 10 months 1 day 00:00:10']::INTERVAL[]);
----
e\x1B\x03\x00\x00\x00\x02\x0D\x00\x00\x00\x12\x00\x00\x00\x00\xE4\x0BT\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x82\x00\x00\x00\x01\x00\x00\x00\x80\x96\x98\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('INTERVAL[]', 'e\x1B\x03\x00\x00\x00\x02\x0D\x00\x00\x00\x12\x00\x00\x00\x00\xE4\x0BT\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x82\x00\x00\x00\x01\x00\x00\x00\x80\x96\x98\x00\x00\x00\x00\x00'::BLOB);
----
[1 year 1 month 18 days 02:46:40, NULL, 10 years 10 months 1 day 00:00:10]

query I
SELECT VARIANT(['6b6542ea-863f-4b10-b5ff-ab9ed50f4291', NULL, '33b66900-6d7e-11ec-90d6-0242ac120003']::UUID[]);
----
e6\x03\x00\x00\x00\x02\x91B\x0F\xD5\x9E\xAB\xFF\xB5\x10K?\x86\xEABe\xEB\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x12\xACB\x02\xD6\x90\xEC\x11~m\x00i\xB6\xB3

query I
SELECT FROM_VARIANT('UUID[]', 'e6\x03\x00\x00\x00\x02\x91B\x0F\xD5\x9E\xAB\xFF\xB5\x10K?\x86\xEABe\xEB\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x12\xACB\x02\xD6\x90\xEC\x11~m\x00i\xB6\xB3'::BLOB);
----
[6b6542ea-863f-4b10-b5ff-ab9ed50f4291, NULL, 33b66900-6d7e-11ec-90d6-0242ac120003]

query I
SELECT VARIANT([3.141, NULL, -0.001]::DECIMAL(4,3)[]);
----
e\x15\x04\x03\x03\x00\x00\x00\x02E\x0C\x00\x00\xFF\xFF

query I
SELECT FROM_VARIANT('DECIMAL(4,3)[]', 'e\x15\x04\x03\x03\x00\x00\x00\x02E\x0C\x00\x00\xFF\xFF'::BLOB);
----
[3.141, NULL, -0.001]

query I
SELECT VARIANT([3.14159265, NULL, 0.00000001]::DECIMAL(9,8)[]);
----
e\x15\x09\x08\x03\x00\x00\x00\x02\xA1\xB0\xB9\x12\x00\x00\x00\x00\x01\x00\x00\x00

query I
SELECT FROM_VARIANT('DECIMAL(9,8)[]', 'e\x15\x09\x08\x03\x00\x00\x00\x02\xA1\xB0\xB9\x12\x00\x00\x00\x00\x01\x00\x00\x00'::BLOB);
----
[3.14159265, NULL, 0.00000001]

query I
SELECT VARIANT([3.14159265358979323, NULL, 0.00000000000000001]::DECIMAL(18,17)[]);
----
e\x15\x12\x11\x03\x00\x00\x00\x02\xFB\xA0\x9E\xF6/\x1E\x5C\x04\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('DECIMAL(18,17)[]', 'e\x15\x12\x11\x03\x00\x00\x00\x02\xFB\xA0\x9E\xF6/\x1E\x5C\x04\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'::BLOB);
----
[3.14159265358979323, NULL, 0.00000000000000001]

query I
SELECT VARIANT([-1.70141183460469231731687303715884105727, NULL, 0.0000000000000000000000000000001]::DECIMAL(32,31)[]);
----
e\x15 \x1F\x03\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\xC0\x85\x1A*k@)\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00

query I
SELECT FROM_VARIANT('DECIMAL(32,31)[]', 'e\x15 \x1F\x03\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\xC0\x85\x1A*k@)\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'::BLOB);
----
[-1.7014118346046922403247749595136, NULL, 0.0000000000000000000000000000001]

query I
SELECT VARIANT([]::VARCHAR[]);
----
e\x19

query I
SELECT FROM_VARIANT('VARCHAR[]', 'e\x19'::BLOB);
----
[]

query I
SELECT VARIANT(['', NULL, 'a string']);
----
e\x19\x03\x00\x00\x00\x02\x10\x00\x00\x00\x10\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00a string

query I
SELECT FROM_VARIANT('VARCHAR[]', 'e\x19\x03\x00\x00\x00\x02\x10\x00\x00\x00\x10\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00a string'::BLOB);
----
[, NULL, a string]

query I
SELECT VARIANT(['a\x00blob', NULL, '', 'a blob']::BLOB[]);
----
e\x1A\x04\x00\x00\x00\x02\x14\x00\x00\x00\x1A\x00\x00\x00\x1A\x00\x00\x00\x1A\x00\x00\x00 \x00\x00\x00a\x00bloba blob

query I
SELECT FROM_VARIANT('BLOB[]', 'e\x1A\x04\x00\x00\x00\x02\x14\x00\x00\x00\x1A\x00\x00\x00\x1A\x00\x00\x00\x1A\x00\x00\x00 \x00\x00\x00a\x00bloba blob'::BLOB);
----
[a\x00blob, NULL, , a blob]

query I
SELECT VARIANT(['one', NULL, 'two', 'three']::ENUM_TYPE[]);
----
e\x19\x04\x00\x00\x00\x02\x14\x00\x00\x00\x17\x00\x00\x00\x17\x00\x00\x00\x1A\x00\x00\x00\x1F\x00\x00\x00onetwothree

query I
SELECT FROM_VARIANT('VARCHAR[]', 'e\x19\x04\x00\x00\x00\x02\x14\x00\x00\x00\x17\x00\x00\x00\x17\x00\x00\x00\x1A\x00\x00\x00\x1F\x00\x00\x00onetwothree'::BLOB);
----
[one, NULL, two, three]

query I
SELECT VARIANT([[1, 2, 3, NULL], [4, 5, 6], NULL, [], [1]]::SMALLINT[][]);
----
ee\x0C\x05\x00\x00\x00\x04\x18\x00\x00\x00%\x00\x00\x000\x00\x00\x000\x00\x00\x000\x00\x00\x007\x00\x00\x00\x04\x00\x00\x00\x08\x01\x00\x02\x00\x03\x00\x00\x00\x03\x00\x00\x00\x00\x04\x00\x05\x00\x06\x00\x01\x00\x00\x00\x00\x01\x00

query I
SELECT FROM_VARIANT('SMALLINT[][]', 'ee\x0C\x05\x00\x00\x00\x04\x18\x00\x00\x00%\x00\x00\x000\x00\x00\x000\x00\x00\x000\x00\x00\x007\x00\x00\x00\x04\x00\x00\x00\x08\x01\x00\x02\x00\x03\x00\x00\x00\x03\x00\x00\x00\x00\x04\x00\x05\x00\x06\x00\x01\x00\x00\x00\x00\x01\x00'::BLOB);
----
[[1, 2, 3, NULL], [4, 5, 6], NULL, [], [1]]

query I
SELECT VARIANT([['a', 'bbb', 'cdefg', NULL], ['h', 'ij', 'klm'], NULL, [], ['', '']]);
----
ee\x19\x05\x00\x00\x00\x04\x18\x00\x00\x00:\x00\x00\x00U\x00\x00\x00U\x00\x00\x00U\x00\x00\x00f\x00\x00\x00\x04\x00\x00\x00\x08\x14\x00\x00\x00\x15\x00\x00\x00\x18\x00\x00\x00\x1D\x00\x00\x00\x1D\x00\x00\x00abbbcdefg\x03\x00\x00\x00\x00\x10\x00\x00\x00\x11\x00\x00\x00\x13\x00\x00\x00\x16\x00\x00\x00hijklm\x02\x00\x00\x00\x00\x0C\x00\x00\x00\x0C\x00\x00\x00\x0C\x00\x00\x00

query I
SELECT FROM_VARIANT('VARCHAR[][]', 'ee\x19\x05\x00\x00\x00\x04\x18\x00\x00\x00:\x00\x00\x00U\x00\x00\x00U\x00\x00\x00U\x00\x00\x00f\x00\x00\x00\x04\x00\x00\x00\x08\x14\x00\x00\x00\x15\x00\x00\x00\x18\x00\x00\x00\x1D\x00\x00\x00\x1D\x00\x00\x00abbbcdefg\x03\x00\x00\x00\x00\x10\x00\x00\x00\x11\x00\x00\x00\x13\x00\x00\x00\x16\x00\x00\x00hijklm\x02\x00\x00\x00\x00\x0C\x00\x00\x00\x0C\x00\x00\x00\x0C\x00\x00\x00'::BLOB);
----
[[a, bbb, cdefg, NULL], [h, ij, klm], NULL, [], [, ]]

query I
SELECT VARIANT([{'bool': TRUE, 'string': 'hello', 'a list': [0, NULL, 127]::TINYINT[], 'nil': NULL, 'another list': []::VARCHAR[], 'nested': {'child1': 123, 'child2': 'a string'}}, NULL, {'bool': FALSE, 'string': 'goodbye', 'a list': []::TINYINT[], 'nil': NULL, 'another list': ['one', 'two'], 'nested': {'child1': 456, 'child2': 'also a string'}}]);
----
ed\x18\x00\x00\x00!\x00\x00\x00,\x00\x00\x008\x00\x00\x00@\x00\x00\x00R\x00\x00\x00\x04\x00\x00\x00bool\x0A\x06\x00\x00\x00string\x19\x06\x00\x00\x00a liste\x0B\x03\x00\x00\x00nil\x01\x0C\x00\x00\x00another liste\x19\x06\x00\x00\x00nestedd\x08\x00\x00\x00\x13\x00\x00\x00\x06\x00\x00\x00child1\x0D\x06\x00\x00\x00child2\x19\x03\x00\x00\x00\x02\x10\x00\x00\x00T\x00\x00\x00T\x00\x00\x00\xAE\x00\x00\x00\x08\x1C\x00\x00\x00\x1D\x00\x00\x00"\x00\x00\x00*\x00\x00\x00*\x00\x00\x00*\x00\x00\x00C\x00\x00\x00\x01hello\x03\x00\x00\x00\x02\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00{\x00\x00\x00a string\x08\x1C\x00\x00\x00\x1D\x00\x00\x00$\x00\x00\x00$\x00\x00\x00$\x00\x00\x00;\x00\x00\x00Y\x00\x00\x00\x00goodbye\x02\x00\x00\x00\x00\x0C\x00\x00\x00\x0F\x00\x00\x00\x12\x00\x00\x00onetwo\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x1D\x00\x00\x00\xC8\x01\x00\x00also a string

query I
SELECT VARIANT({'bool': TRUE, 'string': 'hello', 'a list': [0, NULL, 127]::TINYINT[], 'nil': NULL, 'another list': []::VARCHAR[], 'nested': {'child1': 123, 'child2': 'a string'}});
----
d\x18\x00\x00\x00!\x00\x00\x00,\x00\x00\x008\x00\x00\x00@\x00\x00\x00R\x00\x00\x00\x04\x00\x00\x00bool\x0A\x06\x00\x00\x00string\x19\x06\x00\x00\x00a liste\x0B\x03\x00\x00\x00nil\x01\x0C\x00\x00\x00another liste\x19\x06\x00\x00\x00nestedd\x08\x00\x00\x00\x13\x00\x00\x00\x06\x00\x00\x00child1\x0D\x06\x00\x00\x00child2\x19\x08\x1C\x00\x00\x00\x1D\x00\x00\x00"\x00\x00\x00*\x00\x00\x00*\x00\x00\x00*\x00\x00\x00C\x00\x00\x00\x01hello\x03\x00\x00\x00\x02\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00{\x00\x00\x00a string

query I
SELECT VARIANT([{'bool': TRUE, 'string': 'hello', 'a list': [0, NULL, 127]::TINYINT[], 'another list': []::VARCHAR[], 'nested': {'child1': 123, 'child2': 'a string'}}, NULL, {'bool': FALSE, 'string': 'goodbye', 'a list': []::TINYINT[], 'another list': ['one', 'two'], 'nested': {'child1': 456, 'child2': 'also a string'}}]);
----
ed\x14\x00\x00\x00\x1D\x00\x00\x00(\x00\x00\x004\x00\x00\x00F\x00\x00\x00\x04\x00\x00\x00bool\x0A\x06\x00\x00\x00string\x19\x06\x00\x00\x00a liste\x0B\x0C\x00\x00\x00another liste\x19\x06\x00\x00\x00nestedd\x08\x00\x00\x00\x13\x00\x00\x00\x06\x00\x00\x00child1\x0D\x06\x00\x00\x00child2\x19\x03\x00\x00\x00\x02\x10\x00\x00\x00P\x00\x00\x00P\x00\x00\x00\xA6\x00\x00\x00\x00\x18\x00\x00\x00\x19\x00\x00\x00\x1E\x00\x00\x00&\x00\x00\x00&\x00\x00\x00?\x00\x00\x00\x01hello\x03\x00\x00\x00\x02\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00{\x00\x00\x00a string\x00\x18\x00\x00\x00\x19\x00\x00\x00 \x00\x00\x00 \x00\x00\x007\x00\x00\x00U\x00\x00\x00\x00goodbye\x02\x00\x00\x00\x00\x0C\x00\x00\x00\x0F\x00\x00\x00\x12\x00\x00\x00onetwo\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x1D\x00\x00\x00\xC8\x01\x00\x00also a string

query I
SELECT FROM_VARIANT('STRUCT(bool BOOLEAN, string VARCHAR, "a list" TINYINT[], "another list" VARCHAR[], nested STRUCT(child1 INTEGER, child2 VARCHAR))[]', 'ed\x14\x00\x00\x00\x1D\x00\x00\x00(\x00\x00\x004\x00\x00\x00F\x00\x00\x00\x04\x00\x00\x00bool\x0A\x06\x00\x00\x00string\x19\x06\x00\x00\x00a liste\x0B\x0C\x00\x00\x00another liste\x19\x06\x00\x00\x00nestedd\x08\x00\x00\x00\x13\x00\x00\x00\x06\x00\x00\x00child1\x0D\x06\x00\x00\x00child2\x19\x03\x00\x00\x00\x02\x10\x00\x00\x00P\x00\x00\x00P\x00\x00\x00\xA6\x00\x00\x00\x00\x18\x00\x00\x00\x19\x00\x00\x00\x1E\x00\x00\x00&\x00\x00\x00&\x00\x00\x00?\x00\x00\x00\x01hello\x03\x00\x00\x00\x02\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00{\x00\x00\x00a string\x00\x18\x00\x00\x00\x19\x00\x00\x00 \x00\x00\x00 \x00\x00\x007\x00\x00\x00U\x00\x00\x00\x00goodbye\x02\x00\x00\x00\x00\x0C\x00\x00\x00\x0F\x00\x00\x00\x12\x00\x00\x00onetwo\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x1D\x00\x00\x00\xC8\x01\x00\x00also a string'::BLOB);
----
[{'bool': True, 'string': hello, 'a list': [0, NULL, 127], 'another list': [], 'nested': {'child1': 123, 'child2': a string}}, NULL, {'bool': False, 'string': goodbye, 'a list': [], 'another list': [one, two], 'nested': {'child1': 456, 'child2': also a string}}]

query I
SELECT VARIANT({'bool': TRUE, 'string': 'hello', 'a list': [0, NULL, 127]::TINYINT[], 'another list': []::VARCHAR[], 'nested': {'child1': 123, 'child2': 'a string'}});
----
d\x14\x00\x00\x00\x1D\x00\x00\x00(\x00\x00\x004\x00\x00\x00F\x00\x00\x00\x04\x00\x00\x00bool\x0A\x06\x00\x00\x00string\x19\x06\x00\x00\x00a liste\x0B\x0C\x00\x00\x00another liste\x19\x06\x00\x00\x00nestedd\x08\x00\x00\x00\x13\x00\x00\x00\x06\x00\x00\x00child1\x0D\x06\x00\x00\x00child2\x19\x00\x18\x00\x00\x00\x19\x00\x00\x00\x1E\x00\x00\x00&\x00\x00\x00&\x00\x00\x00?\x00\x00\x00\x01hello\x03\x00\x00\x00\x02\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00{\x00\x00\x00a string

query I
SELECT FROM_VARIANT('STRUCT(bool BOOLEAN, string VARCHAR, "a list" TINYINT[], "another list" VARCHAR[], nested STRUCT(child1 INTEGER, child2 VARCHAR))', 'd\x14\x00\x00\x00\x1D\x00\x00\x00(\x00\x00\x004\x00\x00\x00F\x00\x00\x00\x04\x00\x00\x00bool\x0A\x06\x00\x00\x00string\x19\x06\x00\x00\x00a liste\x0B\x0C\x00\x00\x00another liste\x19\x06\x00\x00\x00nestedd\x08\x00\x00\x00\x13\x00\x00\x00\x06\x00\x00\x00child1\x0D\x06\x00\x00\x00child2\x19\x00\x18\x00\x00\x00\x19\x00\x00\x00\x1E\x00\x00\x00&\x00\x00\x00&\x00\x00\x00?\x00\x00\x00\x01hello\x03\x00\x00\x00\x02\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x18\x00\x00\x00{\x00\x00\x00a string'::BLOB);
----
{'bool': True, 'string': hello, 'a list': [0, NULL, 127], 'another list': [], 'nested': {'child1': 123, 'child2': a string}}

query I
SELECT VARIANT(map(['key1', 'key2'], [1, 2]));
----
f\x08\x00\x00\x00\x11\x00\x00\x00\x03\x00\x00\x00keye\x19\x05\x00\x00\x00valuee\x0D\x00\x0C\x00\x00\x00%\x00\x00\x002\x00\x00\x00\x02\x00\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x14\x00\x00\x00key1key2\x02\x00\x00\x00\x00\x01\x00\x00\x00\x02\x00\x00\x00

query I
SELECT FROM_VARIANT('MAP(VARCHAR, INTEGER)', 'f\x08\x00\x00\x00\x11\x00\x00\x00\x03\x00\x00\x00keye\x19\x05\x00\x00\x00valuee\x0D\x00\x0C\x00\x00\x00%\x00\x00\x002\x00\x00\x00\x02\x00\x00\x00\x00\x0C\x00\x00\x00\x10\x00\x00\x00\x14\x00\x00\x00key1key2\x02\x00\x00\x00\x00\x01\x00\x00\x00\x02\x00\x00\x00'::BLOB);
----
{key1=1, key2=2}
